Apple Mobile Device Management Protocol Reference
===

- [元記事](https://developer.apple.com/business/documentation/MDM-Protocol-Reference.pdf)
- [Rubyで実装した場合](https://developer.apple.com/library/archive/documentation/NetworkingInternet/Conceptual/iPhoneOTAConfiguration/profile-service/profile-service.html)

# About Mobile Device Management

Mobile Device Management (MDM)プロトコルは、システム管理者がiOS 4以降のiOSデバイス、macOS v10.7以降のmacOSデバイス、iOS 7 (Apple TV software 6.0)以降のApple TVデバイスを管理するためのデバイス管理コマンドを送信する方法を提供します。IT管理者は、MDMサービスを介して、プロファイルの検査、インストール、削除、パスコードの削除、管理されたデバイスの安全な消去を開始することができます。

MDMプロトコルは、HTTP、トランスポート層のセキュリティ（TLS）、プッシュ通知の上に構築されています。関連するMDM チェックインプロトコルは、初期登録プロセスを別のサーバーに委任する方法を提供します。

MDM は Apple Push Notification Service (APNS) を使用して、管理されたデバイスに「ウェイクアップ」メッセージを配信します。このサービスでは、管理されているデバイスに「ウェイクアップ」メッセージを配信します。デバイスは、コマンドを取得して結果を返すために、あらかじめ設定されたウェブサービスに接続します。

MDM サービスを提供するには、IT 部門は HTTPS サーバを導入して MDM サーバとして動作させ、MDM ペイロードを含むプロファイルを管理デバイスに配布する必要があります。

管理されたデバイスは、TLS (SSL) を介して MDM サーバーに自分自身を認証するために ID を使用します。この ID は、証明書ペイロードとしてプロファイルに含めることも、SCEP でデバイスを登録することで生成することもできます。

> NOTE
>
> SCEP についての情報は、http://datatracker.ietf.org/doc/draft-nourse-scep/ にある SCEP 仕様書のドラフトを参照してください。

MDM ペイロードは、電子メールやウェブページを使用して配布されるコンフィグレーションプロファイル(.mobileconfig)ファイル内に配置したり、無線登録サービスによって配信される最終的なコンフィグレーションプロファイルの一部として、あるいはデバイス登録プログラムを使用して自動的に配置することができます。一度にデバイスにインストールできるMDMペイロードは1つだけです。

MDM サービスを通じてインストールされた構成プロファイルとプロビジョニングプロファイルは、管理プロファイルと呼ばれます。これらのプロファイルは、MDM ペイロードが削除されると自動的に削除されます。MDM サービスは、設定プロファイルまたはプロビジョニングプロファイルの完全なリストをデバイスを検査する権限を持っていますが、もともとインストールされていたアプリ、設定プロファイル、およびプロビジョニングプロファイルのみを削除することができます。管理プロファイルを使用してインストールされたアカウントは、管理アカウントと呼ばれます。

管理されたプロファイルに加えて、MDMを使用してアプリをインストールすることもできます。MDM サービスを通じてインストールされたアプリは、マネージドアプリと呼ばれます。MDM サービスは、管理されたアプリとそのデータがデバイス上でどのように使用されるかをさらに制御します。

iOS 5以降を実行しているデバイスは、[Apple Configurator 2](https://apps.apple.com/us/app/apple-configurator-2/id1037126344?mt=12)でデプロイの準備をしているときに監視対象として指定することができます。さらに、iOS 7以降を実行しているデバイスは、Device Enrollment Programを使用して監視対象とすることができます。監視対象デバイスを使用すると、組織は、その構成と制限をさらに制御できます。このドキュメントでは、設定オプションが監視対象デバイスに限定されている場合は、その説明にその制限が記載されています。

プロファイルがデバイス登録プログラムを使用してインストールされていない限り、ユーザーは MDM ペイロードをいつでも削除することができます。MDM サーバは、そのアクセス権に関係なく、いつでも自分のプロファイルを削除することができます。このような場合には、以下のようになります。macOS v10.8以降とiOS 5では、MDMクライアントはCheckOutを使ってサーバへの連絡を1回試みます。コマンドを使用してプロファイルを削除します。以前のOSバージョンでは、デバイスは ユーザーはペイロードを削除します。以下ではないデバイスを検出する方法に関する推奨事項については、「MDM ベストプラクティス」を参照してください。より管理されています。

MDM ペイロードを含むプロファイルは、デバイス登録プログラムを使用してインストールされていない限り、ロックすることはできません。ただし、MDM を通してインストールされた管理されたプロファイルはロックされる可能性があります。MDMを通じてインストールされたすべての管理されたプロファイルは、ロックされていても、メインのMDMプロファイルが削除されると削除されます。

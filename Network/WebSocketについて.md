# WebSocketのキホン

## Ajax・Comet・WebSocketを比較

### HTTPについて
- 要求に対しては返す様式
- Server側からClientに直接送信ができない
	- ClientがFireWallの背後にいるため
	- 電話で例えると、着信拒否をかけられているようなもの

## それぞれの接続方法の特徴

### 接続の持続性
**Ajax**
- 接続一回に対して、情報の取得処理は多くて一回
- Clientは定期的にServerに接続を行う(ポーリング)

**Comet**
- Serverは応答を返すのをできるだけ引き伸ばす(ロングポーリング)
- WebServerの本来の動作に反する
	- リクエストに対してできるだけ早く返すのが本来の動作
- 引き伸ばせる時間に上限があるため、再接続が必要

**WebSocket**
- 一度接続してしまえば、つなぎっぱなしにできる。
- 接続が切れない限り、再接続は不要。

### 接続処理のコスト
- 接続処理は負荷が高い。通信したい情報に対してHTTP Headerが大きい。Serverにとっても負荷が大きい。
	- AjaxとCometでは高頻度で発生
	- WebSocketでは一回のみ

### 双方向性とリアルタイム性
**Ajax**
- Client側からのみリアルタイムに送信が可能
- Server側の情報はClientが取得しに行く必要がある。
- Server側に届いた情報をClientに即時反映できない
- Client側からの送信は、別処理として書くことが多い

**Comet**
- Server側からリアルタイムに送信が可能
- Client側からの送信はAjaxで別に行う。

**WebSocket**
- Server/Clientの双方からリアルタイムに送信が可能
- 接続の確立はClientから行う必要がある。

## まとめ
**Ajax**
- 負荷が**高い**
- サーバ側の情報取得は**定期的**
- クライアント側の情報送信は**別接続**で行うことが多い

**Comet**
- 負荷が非常に**高い**
- サーバ側の情報取得は**リアルタイム**
- クライアント側の情報送信も**別接続のAjax**

**WebSocket**
- 負荷が非常に**高い**
- サーバ側の情報取得は**リアルタイム**
- クライアント側の情報送信も**同じ接続内(双方向通信)**

## WebSocketとHTTPの関係
- 利用するPort番号はHTTP/HTTPSと同じ。現在の使用では80番と443番
- 接続処理にHTTPを使う
- 接続時のヘッダはほぼ全てHTTP
- セキュアなWebSocketを使うと更に通過しやすい。接続にHTTPSを使うことでBody部が隠蔽されるため。
- Upgradeという処理を経てWebSocketに変更
- ネットワーク機器からはHTTPに見える
- ネットワークの設定変更の必要が殆ど無い
- ただし、脆弱性対策のためHTTOとの互換性が若干低下

## WebSocketとブラウザの関係
- HTML5関連技術として策定されている
- 各ブラウザがWebSocketへの対応を進めている
- ブラウザをバージョンアップするだけで良い
- ブラウザ上のJavaScriptからもAPI経由で使える
- バイナリも扱える
- 標準仕様で双方向通信ができるのはWebSocketが初
- ウェブアプリケーションの通信部分の基礎になる可能性

# 参考サイト
- https://www.slideshare.net/You_Kinjoh/websocket-10621887
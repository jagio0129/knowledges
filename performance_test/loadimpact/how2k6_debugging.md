What's the best way to debug my load test scripts?
===

- [公式リファレンス](https://support.loadimpact.com/4.0/frequently-asked-questions/debugging-test-scripts/)

## Background
開発において一般的な作業は、コードをデバッグして、期待通りの出力や結果が得られているかどうかを確認することです。LoadImpact は、負荷テストを記述するスクリプト言語として JavaScript を利用しています。テストは実際のコードで書かれているため、テストスクリプトを実行する前にデバッグを行うことができます。このドキュメントのヒントを活用して、スクリプト開発のスピードアップに役立ててください。

## Tip 1: Use k6 locally to debug your scripts
LoadImpact アプリケーションには IDE が組み込まれていますが、デバッグ機能は一部のリントに限られています。k6 をローカルに使用すると、テストスクリプトを小規模なものとして実際に実行して、スクリプトの実行状況を素早く確認することができます。

## Tip 2: Debug locally only.
上記のヒント1を参考にして、-o cloudを使って結果をクラウドにストリーミングしたり、クラウドサービスを使ってテストを実行したりするのは避けたいと思います。これには2つの理由があります。

1. クラウド内で実行したり、クラウドにストリーミングしたりするテストは、あなたが設定した制限に反してカウントされます。
2. ストリーミングやクラウドで実行すると実行が遅くなる。デバッグは高速な反復処理にしたい。

例: `k6 run myScript.js`

デバッグ時には、期待通りに動作するかどうかを確認するためにスクリプトを処理しながら多くの変更を行うことになるでしょう。クラウドから送信されたデータや実行されたデータはあまり価値がないので、大規模なテストを実行する必要があるまではローカルに保管しておきましょう。

## Tip 3: Use flags to limit execution when debugging
スクリプトで仮想ユーザーや期間を設定している可能性があります。フラグ `-i 1 -u 1` を追加すると、k6 は 1 人の仮想ユーザーで 1 回のイテレーションを実行するように指示します。

例: `k6 run myScript.js -i 1 -u 1`

注意: 1仮想ユーザと1反復は、k6のデフォルトの実行でもあります。テストでVUやイテレーションを定義していない場合、k6は1で実行されます。

## Tip 4: Use builtin debugging options
時には、送信されたリクエストと受信したレスポンスの詳細を理解したいこともあるでしょう。フラグとして `--http-debug` を使うと、それが可能になります。また、 `--http-debug="full"` と指定することで、 レスポンスの全文を表示することもできます。

例: `k6 run myScript.js --http-debug="full"`

注意: テストスクリプトに大量の HTTP リクエストがある場合、大きな出力を生成します。

## Tip 5: Print info to the terminal window with console.log(); when debugging
時々、ターミナルウィンドウに情報を表示した方が簡単な場合があります。ターミナルウィンドウに有用な情報を表示するには console.log(); を遠慮なく使ってください。レスポンスで返された JSON や特定のレスポンスボディを調べたい場合や、ループや IF 文を正しく入力/終了したかどうかを知りたい場合もあるでしょう。

上記をさらに一歩進めて、次のコードのスニペットを考えてみましょう。GETリクエストを行い、レスポンスをresに保存し、完全なレスポンスオブジェクトをロギングしています。ここで、テストスクリプトを適応させるために探しているものを正確に見つけるために、このコードを調べてみましょう。

```js
let res = http.get("http://httpbin.test.loadimpact.com/json").
console.log(JSON.stringify(res)).
```

テストで何かが起こったかどうかを記録しておくことがテストに役立つと思うならば、チェックやカスタムメトリクスを使うことを検討してみてはいかがでしょうか。発生したことを定量化するために、チェックやカスタムメトリクスを使うことを検討するとよいでしょう。

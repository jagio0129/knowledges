バックアップ
===

## 概要
MongoDBをバックアップするには、データそのもののバックアップとコンフィグオプションのバックアップが必要となる。

コンフィグオプションは、mongdの起動引数かコンフィグファイルで指定する。どちらの場合も、mongod起動シェルやコンフィグファイルなどのファイルをコピーするだけでバックアップ可能

データのバックアップには一般的にフルバックアップと差分バックアップを組み合わせて使用するが、MongoDBに差分バックアップ機能はない。具体的には以下の2通りの方法がある。

- データファイルをコピー
- mongodumpを利用する方法

## データファイルをコピーする方法

データファイルをコピーする方法は、データの変換がないため手軽で高速だが、その間データベースは停止するかロックしておく必要がある。多くの場合はセカンダリに対してこの操作を行う。その際はOplogの溢れが発生しないように注意しなければいけない。

## mongodumpを利用する方法

mongodumpを利用する方法では、オンラインバックアップが可能。またデータをバイナリ(BSON)形式でダンプするため、データの変換に時間がかかる代わりに、ファイルサイズを比較的小さく抑えられる利点がある。ただし、インデックスはダンプされずにリストア時に再構築されるため、大きなインデックスがある場合にはリストアに時間がかかることに注意。


## 参考サイト
- [MongoDBのバックアップ](https://gihyo.jp/dev/serial/01/mongodb/0011)
- [backup](https://docs.opsmanager.mongodb.com/current/core/backup-overview/index.html)
